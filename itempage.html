<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Item Page</title>
  <style>
    * {
      box-sizing: border-box;
    }

body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  min-height: 100vh;
  position: relative;
  display: flex;
  flex-direction: column;

  background-color: #e5e5e5;
  background-repeat: no-repeat;
  background-position: center center;
  background-attachment: fixed;
  background-size: cover;
}


    /* Home button with glossy style */
    #homeBtn {
      position: fixed;
      top: 15px;
      left: 15px;
      padding: 8px 14px;
      background: linear-gradient(180deg, #555, #222);
      color: white;
      border: 1px solid black;
      cursor: pointer;
      font-weight: bold;
      z-index: 1000;
      border-radius: 4px;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.3),
        0 3px 5px rgba(0,0,0,0.4);
      text-shadow: 0 1px 0 #000;
      transition: background 0.3s ease;
      outline: none;
    }
    #homeBtn:hover {
      background: linear-gradient(180deg, #777, #444);
    }

    .product-page {
      margin: 80px auto 0;
      display: flex;
      gap: 30px;
      width: 90%;
      max-width: 1100px;
      background: transparent;
      padding: 30px 0 20px 0;
      border-radius: 0;
      flex: 1 0 auto;
    }

  .product-image-gallery {
  display: flex;
  flex-direction: column;
  gap: 15px;
  overflow-y: auto;
  max-height: none; /* remove the forced cut-off height */
  width: 400px;
  padding-right: 0;
  border: none;
  scrollbar-width: none;
  -ms-overflow-style: none;
  overflow-x: hidden;
  scroll-snap-type: y mandatory;
  background: white; /* gives a solid background behind all images */
  padding: 10px;
}

.product-image-gallery::-webkit-scrollbar {
  display: none;
}

.product-image-gallery img {
  height: auto;
  width: 100%;
  max-height: 400px;
  object-fit: contain;
  cursor: pointer;
  border: 1px solid black;
  background: white;
  transition: transform 0.2s;
  scroll-snap-align: start;
  padding: 5px;
}
    .product-image-gallery img:hover {
      transform: scale(1.03);
    }

    .product-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      gap: 15px;
      background: transparent;
      color: #222;
      font-size: 22px;
      line-height: 1.5;
      padding-left: 10px;
      padding: 20px;
    }

    .product-info h1 {
      font-size: 38px;
      margin-bottom: 10px;
      text-transform: uppercase;
      font-weight: 900;
      letter-spacing: 1.2px;
      border: none;
      padding: 0;
      margin: 0 0 10px 0;
    }

    .product-info p {
      margin: 0;
      font-weight: 600;
      border: none;
    }

    .price {
      font-size: 28px;
      font-weight: 900;
      margin: 10px 0;
      color: green;
      border: none;
      padding: 0;
    }

    .count {
      display: flex;
      align-items: center;
      gap: 15px;
      margin: 20px 0 30px;
    }

    .count button {
      width: 40px;
      height: 40px;
      font-size: 22px;
      background: #ddd;
      border: 1px solid black;
      cursor: pointer;
      border-radius: 0;
      font-weight: bold;
      transition: background-color 0.3s;
      box-shadow: none;
      outline: none;
    }

    .count button:hover {
      background: #bbb;
    }

    /* Buy button with early 2000s glossy green style */
    .buy-btn {
      padding: 12px 24px;
      background: linear-gradient(180deg, #55cc55, #117711);
      color: white;
      border: 1px solid black;
      border-radius: 4px;
      cursor: pointer;
      font-size: 18px;
      font-weight: 900;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.7),
        0 3px 5px rgba(0,0,0,0.4);
      align-self: flex-start;
      transition: background 0.3s ease;
      letter-spacing: 1px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      position: relative;
      overflow: hidden;
      text-shadow: 0 1px 0 #004400;
    }
    .buy-btn::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50%;
      background: rgba(255,255,255,0.3);
      border-radius: 4px 4px 0 0;
      pointer-events: none;
      filter: blur(2px);
      mix-blend-mode: screen;
    }
    .buy-btn:hover {
      background: linear-gradient(180deg, #66dd66, #228822);
    }

    .image-modal {
      display: none;
      position: fixed;
      z-index: 2000;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      justify-content: center;
      align-items: center;
      cursor: grab;
    }

    .image-modal img {
      max-width: 95%;
      max-height: 95%;
      border-radius: 0;
      transition: transform 0.2s;
      border: 2px solid black;
      background: white;
    }

    #popup {
      position: fixed;
      top: 15%;
      left: 70%;
      transform: translate(-50%, -150%);
      background: white;
      padding: 20px 30px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
      text-align: center;
      z-index: 1000;
      width: 320px;
      opacity: 0;
      pointer-events: none;
      transition: top 0.5s ease, left 0.5s ease, opacity 0.5s ease, transform 0.5s ease;
      font-family: Arial, sans-serif;
      font-weight: 600;
      color: #222;
      border: 1px solid black;
    }

    #popup.show {
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%, 0);
    }

    #popup p {
      margin-bottom: 20px;
      font-size: 16px;
    }

    #popup button {
      margin: 5px 8px 0 8px;
      padding: 8px 16px;
      background: dodgerblue;
      color: white;
      border: 1px solid black;
      border-radius: 0;
      cursor: pointer;
      min-width: 90px;
      font-weight: 700;
      box-shadow: 0 4px 8px rgba(30, 144, 255, 0.5);
      transition: background-color 0.3s ease;
      outline: none;
    }

    #popup button:hover {
      background: #1e90ffcc;
    }

    /* --- Related items container --- */
#related-items-container {
  margin: 60px auto 0; /* pushes it down further so no overlap */
  width: 100%;
  border-top: 3px solid black;
  padding-top: 20px;
  background: white;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  user-select: none;
  text-transform: uppercase;
  min-height: 100vh;
}
    #related-items-container h2 {
      text-align: center;
      font-weight: 900;
      letter-spacing: 1.3px;
      margin-bottom: 20px;
      color: #222;
      font-size: 24px;
    }

    #related-items {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }

    #related-items .item {
      background: #fff;
      border: 2px solid black;
      width: 150px;
      cursor: pointer;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      border-radius: 0;
      box-shadow: none;
      padding: 8px;
      font-weight: 700;
      color: #222;
      font-size: 14px;
      transition: background-color 0.2s ease;
    }
    #related-items .item:hover {
      background-color: #e6ffe6;
    }

    #related-items .image-wrapper {
      width: 130px;
      height: 130px;
      border: 1px solid black;
      margin-bottom: 8px;
    }

    #related-items .image-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      user-select: none;
      transition: transform 0.2s ease, opacity 0.4s ease;
      border-radius: 0;
      border: none;
      position: relative;
      z-index: 1;
    }

    #related-items .item-name {
      font-weight: 900;
      font-size: 14px;
      margin: 0;
      user-select: none;
    }

    #related-items .item-price {
      color: green;
      font-weight: 900;
      font-size: 14px;
      margin: 4px 0 0 0;
      text-shadow: 0 1px 0 #0a0;
    }

  </style>
</head>
<body>

  <button id="homeBtn">Home</button>

  <div class="product-page">
    <div class="product-image-gallery" id="imageGallery"></div>
    <div class="product-info">
      <h1 id="item-name">ITEM NAME</h1>
      <p><strong>Creator:</strong> <span id="item-creator">Loading...</span></p>
      <p class="price" id="item-price">$0.00 USD</p>
      <p><strong>Description:</strong> <span id="item-desc">Loading...</span></p>
      <p><strong>Available:</strong> <span id="item-quantity">0</span></p>
      <div class="count">
        <button id="decrease">-</button>
        <span id="count">1</span>
        <button id="increase">+</button>
      </div>
      <button class="buy-btn" id="buyBtn">Buy Now</button>
    </div>
  </div>

  <!-- Related Items Section -->
  <section id="related-items-container" aria-label="Related Items">
    <h2>More Items</h2>
    <div id="related-items">Loading related items...</div>
  </section>

  <div class="image-modal" id="imageModal">
    <img id="modalImage" src="" alt="Large preview" />
  </div>

  <div id="popup">
    <p id="popup-message"></p>
    <button id="continueBtn">Continue Shopping</button>
    <button id="viewCartBtn">View Cart</button>
    <button id="checkOutBtn">Check Out</button>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyABT1dlkE7m0k9pLtP_l5mhk10NRlNoDb8",
    authDomain: "nofootage2010.firebaseapp.com",
    projectId: "nofootage2010",
    storageBucket: "nofootage2010.firebasestorage.app",
    messagingSenderId: "1098446374131",
    appId: "1:1098446374131:web:499c1e6a2d5d781adae386"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const item = JSON.parse(localStorage.getItem("selectedItem"));
  if (!item) {
    alert("No item selected.");
    location.href = "index.html";
  }

  // Set page title to item name
  document.title = item.name + " - Item Page";
  // Populate main product info
  document.getElementById("item-name").textContent = item.name;
  document.getElementById("item-creator").textContent = item.creator || "Unknown";
  document.getElementById("item-price").textContent = `$${parseFloat(item.price).toFixed(2)} USD`;
  document.getElementById("item-desc").textContent = item.description || "No description.";
  document.getElementById("item-quantity").textContent = item.quantity;
  if (item.quantity <= 0) {
    document.getElementById("item-quantity").textContent = "NOT IN STOCK";
    document.getElementById("buyBtn").style.display = "none";
    document.querySelector(".count").style.display = "none";
  }

  document.body.style.backgroundImage = `url(assets/${item.name}/backgroundimg.png)`;


  const gallery = document.getElementById("imageGallery");
  const basePath = `assets/${item.name}/images/`;

  for (let i = 1; i <= 5; i++) {
    const path = `${basePath}image${i}.jpg`;
    const img = new Image();
    img.onload = () => {
      img.onclick = () => {
        const modal = document.getElementById("imageModal");
        const modalImage = document.getElementById("modalImage");
        modalImage.src = path;
        modalImage.style.transform = "scale(1)";
        modalImage.style.transformOrigin = "center center";
        modal.style.display = "flex";
        zoomLevel = 1;
      };
      gallery.appendChild(img);
    };
    img.onerror = () => {};
    img.src = path;
  }

  // Modal zooming
  document.getElementById("imageModal").onclick = () => {
    document.getElementById("imageModal").style.display = "none";
  };

  let zoomLevel = 1;
  const modalImage = document.getElementById("modalImage");

  modalImage.addEventListener("wheel", (e) => {
    e.preventDefault();
    const rect = modalImage.getBoundingClientRect();
    const offsetX = e.clientX - rect.left;
    const offsetY = e.clientY - rect.top;
    const xPercent = (offsetX / rect.width) * 100;
    const yPercent = (offsetY / rect.height) * 100;
    modalImage.style.transformOrigin = `${xPercent}% ${yPercent}%`;

    zoomLevel += e.deltaY < 0 ? 0.1 : -0.1;
    zoomLevel = Math.max(0.5, Math.min(zoomLevel, 3));
    modalImage.style.transform = `scale(${zoomLevel})`;
  });

  // Quantity control
  let count = 1;
  const countDisplay = document.getElementById("count");

  document.getElementById("increase").onclick = () => {
    if (count < item.quantity) {
      count++;
      countDisplay.textContent = count;
    }
  };

  document.getElementById("decrease").onclick = () => {
    if (count > 1) {
      count--;
      countDisplay.textContent = count;
    }
  };

  // Add to cart handler
  function addToCart() {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    const existing = cart.find(i => i.name === item.name);

    if (existing) {
      existing.quantity = Math.min(existing.quantity + count, item.quantity);
    } else {
      cart.push({
        name: item.name,
        price: item.price,
        quantity: count,
        max: item.quantity
      });
    }

    localStorage.setItem("cart", JSON.stringify(cart));
    const popup = document.getElementById("popup");
    document.getElementById("popup-message").textContent = `Added ${count}x ${item.name} to cart`;

    // Random popup position near bottom right
    const baseTopPercent = 75;
    const baseLeftPercent = 70;
    const vpWidth = window.innerWidth;
    const vpHeight = window.innerHeight;

    const getRandomOffset = (max) => (Math.random() * 2 - 1) * max;

    const offsetX = getRandomOffset(10);
    const offsetY = getRandomOffset(10);

    let topPx = (baseTopPercent / 100) * vpHeight + offsetY;
    let leftPx = (baseLeftPercent / 100) * vpWidth + offsetX;

    topPx = Math.min(Math.max(50, topPx), vpHeight - 50);
    leftPx = Math.min(Math.max(100, leftPx), vpWidth - 100);

    const topPercent = (topPx / vpHeight) * 100;
    const leftPercent = (leftPx / vpWidth) * 100;

    popup.style.top = topPercent + '%';
    popup.style.left = leftPercent + '%';
    popup.classList.add("show");
  }

  document.getElementById("buyBtn").onclick = addToCart;

  // Popup buttons
  document.getElementById("continueBtn").onclick = () => {
    const popup = document.getElementById("popup");
    popup.classList.remove("show");
    popup.style.top = '25%';
    popup.style.left = '70%';
  };

  document.getElementById("viewCartBtn").onclick = () => {
    location.href = "viewcart.html";
  };

  document.getElementById("checkOutBtn").onclick = () => {
    location.href = "cart.html";
  };

  document.getElementById("homeBtn").onclick = () => {
    location.href = "index.html";
  };

  // --- Related Items Section ---

async function loadRelatedItems() {
  const container = document.getElementById("related-items");
  container.textContent = "Loading related items...";

  try {
    const querySnapshot = await getDocs(collection(db, "catalog"));
    const items = [];
    querySnapshot.forEach(doc => {
      const data = doc.data();
      if (data.name && data.price && data.quantity) {
        items.push(data);
      }
    });

    if (items.length === 0) {
      container.textContent = "No items found.";
      return;
    }

    // Shuffle items randomly
    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }
    shuffleArray(items);

    // Clear container
    container.textContent = "";

    // Show up to 6 items that aren't the current item
    let shown = 0;
    for (const it of items) {
      if (it.name === item.name) continue;
      if (shown >= 6) break;

      const div = document.createElement("div");
      div.className = "item";

      const imgWrapper = document.createElement("div");
      imgWrapper.className = "image-wrapper";

      const img = new Image();
      img.alt = it.name;
      img.src = `assets/${it.name}/images/image1.jpg`;
      imgWrapper.appendChild(img);

      div.appendChild(imgWrapper);

      const nameEl = document.createElement("p");
      nameEl.className = "item-name";
      nameEl.textContent = it.name;
      div.appendChild(nameEl);

      const priceEl = document.createElement("p");
      priceEl.className = "item-price";
      priceEl.textContent = `$${parseFloat(it.price).toFixed(2)} USD`;
      div.appendChild(priceEl);

      div.onclick = () => {
        localStorage.setItem("selectedItem", JSON.stringify(it));
        location.reload(); // reload same page with new item
      };

      container.appendChild(div);
      shown++;
    }
  } catch (err) {
    console.error("Error loading related items:", err);
    container.textContent = "Failed to load related items.";
  }
}

  loadRelatedItems();

</script>

</body>
</html>
